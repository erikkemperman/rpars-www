(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{"86oW":function(e,i,t){"use strict";t.r(i),t.d(i,"TabGroupsPageModule",(function(){return T}));var s=t("TEn/"),o=t("tyNb"),n=t("ofXK"),r=t("3Pt+"),c=t("mrSG"),l=t("AytR"),b=t("fXoL"),a=t("pRC4"),d=t("fJnV");function u(e,i){1&e&&(b.Mb(0,"div"),b.hc(1," Please log in on the Profile tab "),b.Lb())}function h(e,i){if(1&e){const e=b.Nb();b.Mb(0,"ion-item"),b.Mb(1,"ion-label",9),b.hc(2),b.Mb(3,"b"),b.hc(4),b.Lb(),b.Lb(),b.Mb(5,"ion-button",12),b.Ub("click",(function(){b.dc(e);const t=i.$implicit,s=b.Wb().$implicit,o=b.Wb().$implicit;return b.Wb(2).removeUser(o,s,t)})),b.Ib(6,"ion-icon",13),b.Lb(),b.Lb()}if(2&e){const e=i.$implicit;b.xb(2),b.jc(" User #",e.user_id," "),b.xb(2),b.ic(e.user_email)}}function m(e,i){if(1&e&&(b.Mb(0,"ion-select-option",14),b.hc(1),b.Mb(2,"b"),b.hc(3),b.Lb(),b.Lb()),2&e){const e=i.$implicit;b.ac("value",e.user_id),b.xb(1),b.jc(" User #",e.user_id," "),b.xb(2),b.ic(e.user_email)}}function g(e,i){if(1&e){const e=b.Nb();b.Kb(0),b.Mb(1,"ion-list-header"),b.Mb(2,"ion-label"),b.hc(3),b.Mb(4,"b"),b.hc(5),b.Lb(),b.Lb(),b.Lb(),b.Mb(6,"ion-item"),b.Mb(7,"ion-list",7),b.gc(8,h,7,2,"ion-item",6),b.Mb(9,"ion-item",8),b.Mb(10,"ion-label",9),b.Mb(11,"i"),b.hc(12,"Add a user to group "),b.Mb(13,"b"),b.hc(14),b.Lb(),b.hc(15,":"),b.Lb(),b.Lb(),b.Mb(16,"ion-select",10),b.Ub("ionChange",(function(t){b.dc(e);const s=i.$implicit;return b.Wb(3).addUser(s.group_id,t.detail.value)})),b.gc(17,m,4,3,"ion-select-option",11),b.Lb(),b.Lb(),b.Lb(),b.Lb(),b.Jb()}if(2&e){const e=i.$implicit,t=b.Wb(3);b.xb(3),b.jc("Group #",e.group_id," "),b.xb(2),b.ic(e.group_name),b.xb(3),b.Zb("ngForOf",e.group_members),b.xb(1),b.Zb("disabled",0===t.unassigned.length),b.xb(5),b.ic(e.group_name),b.xb(3),b.Zb("ngForOf",t.unassigned)}}function p(e,i){if(1&e&&(b.Kb(0),b.Mb(1,"ion-list-header"),b.Mb(2,"ion-label"),b.hc(3),b.Mb(4,"b"),b.hc(5),b.Lb(),b.Lb(),b.Lb(),b.Mb(6,"ion-item"),b.Mb(7,"ion-list",7),b.gc(8,g,18,6,"ng-container",6),b.Lb(),b.Lb(),b.Jb()),2&e){const e=i.$implicit;b.xb(3),b.jc("Project #",e.project_id," "),b.xb(2),b.ic(e.project_name),b.xb(3),b.Zb("ngForOf",e.project_members)}}function f(e,i){if(1&e&&(b.Mb(0,"div"),b.Mb(1,"ion-list",5),b.gc(2,p,9,3,"ng-container",6),b.Lb(),b.Lb()),2&e){const e=b.Wb();b.xb(2),b.Zb("ngForOf",e.members)}}let O=(()=>{class e{constructor(e,i,t,s,o){this.alertController=e,this.loadingController=i,this.toastController=t,this.sessionService=s,this.memberService=o,this.members=[],this.unassigned=[],this.checker=null}ngOnInit(){console.log("Groups tab: ngOnInit")}ionViewWillEnter(){return Object(c.a)(this,void 0,void 0,(function*(){console.log("Groups tab: will enter"),yield this.checkStatus(),this.checker=setInterval(()=>Object(c.a)(this,void 0,void 0,(function*(){yield this.checkStatus()})),l.a.PERIOD_REENTER)}))}ionViewWillLeave(){return Object(c.a)(this,void 0,void 0,(function*(){console.log("Groups tab: will leave"),this.checker&&clearInterval(this.checker)}))}checkStatus(){return Object(c.a)(this,void 0,void 0,(function*(){console.log("Groups tab: check status"),this.loggedIn=yield this.sessionService.isLoggedIn(),yield this.refreshMembers()}))}refreshMembers(){return Object(c.a)(this,void 0,void 0,(function*(){if(this.loggedIn){const i=yield this.loadingController.create({message:"Loading projects and groups...",backdropDismiss:!1,translucent:!0});yield i.present(),this.members=[],this.unassigned=[];try{this.members=yield this.memberService.getMembers(),console.log("Loaded members:",this.members)}catch(e){return i.dismiss(),(yield this.toastController.create({message:""+e,duration:l.a.TOAST_DURATION_ERROR,position:l.a.TOAST_POSITION,color:"danger"})).present(),!1}try{this.unassigned=yield this.memberService.getUnassignedUsers(),console.log("Unassigned users:",this.unassigned)}catch(e){return i.dismiss(),(yield this.toastController.create({message:""+e,duration:l.a.TOAST_DURATION_ERROR,position:l.a.TOAST_POSITION,color:"danger"})).present(),!1}return i.dismiss(),!0}}))}addUser(e,i){return Object(c.a)(this,void 0,void 0,(function*(){const t=yield this.loadingController.create({message:"Adding user(s) to group...",backdropDismiss:!1,translucent:!0});yield t.present();const s=i.map(e=>parseInt(e));try{yield this.memberService.addUsers(e,s)}catch(o){return t.dismiss(),(yield this.toastController.create({message:""+o,duration:l.a.TOAST_DURATION_ERROR,position:l.a.TOAST_POSITION,color:"danger"})).present(),!1}return t.dismiss(),(yield this.toastController.create({message:"Users added to group",duration:l.a.TOAST_DURATION_SUCCESS,position:l.a.TOAST_POSITION,color:"success"})).present(),yield this.refreshMembers()}))}removeUser(e,i,t){return Object(c.a)(this,void 0,void 0,(function*(){if(!(yield new Promise(s=>Object(c.a)(this,void 0,void 0,(function*(){const o=yield this.alertController.create({header:"Alert!",subHeader:"Are you sure?",message:`Remove user <b>${t.user_email}</b><br />from group <b>${i.group_name}</b><br />in project <b>${e.project_name}</b>?`,buttons:[{text:"Cancel",role:"cancel",cssClass:"secondary",handler:()=>s(!1)},{text:"Confirm",role:"confirm",cssClass:"secondary",handler:()=>s(!0)}]});yield o.present()})))))return;const s=yield this.loadingController.create({message:`Removing user ${t.user_email}...`,backdropDismiss:!1,translucent:!0});yield s.present();try{yield this.memberService.removeUser(t.user_id)}catch(o){return s.dismiss(),(yield this.toastController.create({message:""+o,duration:l.a.TOAST_DURATION_ERROR,position:l.a.TOAST_POSITION,color:"danger"})).present(),!1}return s.dismiss(),(yield this.toastController.create({message:"User removed from group",duration:l.a.TOAST_DURATION_SUCCESS,position:l.a.TOAST_POSITION,color:"success"})).present(),yield this.refreshMembers()}))}}return e.\u0275fac=function(i){return new(i||e)(b.Hb(s.a),b.Hb(s.A),b.Hb(s.E),b.Hb(a.a),b.Hb(d.a))},e.\u0275cmp=b.Bb({type:e,selectors:[["app-tab-groups"]],decls:11,vars:4,consts:[[3,"translucent"],[3,"fullscreen"],["collapse","condense"],["size","large"],[4,"ngIf"],["lines","full",2,"width","100%"],[4,"ngFor","ngForOf"],[2,"width","100%"],[3,"disabled"],["position","stacked"],["multiple","true",3,"ionChange"],[3,"value",4,"ngFor","ngForOf"],["slot","end","fill","none",3,"click"],["slot","icon-only","name","trash-outline"],[3,"value"]],template:function(e,i){1&e&&(b.Mb(0,"ion-header",0),b.Mb(1,"ion-toolbar"),b.Mb(2,"ion-title"),b.hc(3," Groups "),b.Lb(),b.Lb(),b.Lb(),b.Mb(4,"ion-content",1),b.Mb(5,"ion-header",2),b.Mb(6,"ion-toolbar"),b.Mb(7,"ion-title",3),b.hc(8,"Groups"),b.Lb(),b.Lb(),b.Lb(),b.gc(9,u,2,0,"div",4),b.gc(10,f,3,1,"div",4),b.Lb()),2&e&&(b.Zb("translucent",!0),b.xb(4),b.Zb("fullscreen",!0),b.xb(5),b.Zb("ngIf",!i.loggedIn),b.xb(1),b.Zb("ngIf",i.loggedIn))},directives:[s.i,s.x,s.w,s.g,n.i,s.n,n.h,s.o,s.m,s.l,s.r,s.C,s.d,s.j,s.s],styles:[""]}),e})();const v=[{path:"",component:O}];let y=(()=>{class e{}return e.\u0275mod=b.Fb({type:e}),e.\u0275inj=b.Eb({factory:function(i){return new(i||e)},imports:[[o.i.forChild(v)],o.i]}),e})(),T=(()=>{class e{}return e.\u0275mod=b.Fb({type:e}),e.\u0275inj=b.Eb({factory:function(i){return new(i||e)},imports:[[s.y,n.b,r.a,o.i.forChild([{path:"",component:O}]),y]]}),e})()}}]);