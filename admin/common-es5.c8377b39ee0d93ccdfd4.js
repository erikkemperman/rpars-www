!function(){function e(e,r){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,r){if(!e)return;if("string"==typeof e)return t(e,r);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return t(e,r)}(e))||r&&e&&"number"==typeof e.length){n&&(e=n);var s=0,i=function(){};return{s:i,n:function(){return s>=e.length?{done:!0}:{done:!1,value:e[s++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,u=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return o=e.done,e},e:function(e){u=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(u)throw a}}}}function t(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function r(e,t,r,n,s,i,a){try{var o=e[i](a),u=o.value}catch(c){return void r(c)}o.done?t(u):Promise.resolve(u).then(n,s)}function n(e){return function(){var t=this,n=arguments;return new Promise((function(s,i){var a=e.apply(t,n);function o(e){r(a,s,i,o,u,"next",e)}function u(e){r(a,s,i,o,u,"throw",e)}o(void 0)}))}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function a(e,t,r){return t&&i(e.prototype,t),r&&i(e,r),e}(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{"2c9M":function(e,t,r){"use strict";r.d(t,"a",(function(){return i})),r.d(t,"b",(function(){return a})),r.d(t,"c",(function(){return s})),r.d(t,"d",(function(){return u})),r.d(t,"e",(function(){return o}));var n={getEngine:function(){var e=window;return e.TapticEngine||e.Capacitor&&e.Capacitor.isPluginAvailable("Haptics")&&e.Capacitor.Plugins.Haptics},available:function(){return!!this.getEngine()},isCordova:function(){return!!window.TapticEngine},isCapacitor:function(){return!!window.Capacitor},impact:function(e){var t=this.getEngine();if(t){var r=this.isCapacitor()?e.style.toUpperCase():e.style;t.impact({style:r})}},notification:function(e){var t=this.getEngine();if(t){var r=this.isCapacitor()?e.style.toUpperCase():e.style;t.notification({style:r})}},selection:function(){this.impact({style:"light"})},selectionStart:function(){var e=this.getEngine();e&&(this.isCapacitor()?e.selectionStart():e.gestureSelectionStart())},selectionChanged:function(){var e=this.getEngine();e&&(this.isCapacitor()?e.selectionChanged():e.gestureSelectionChanged())},selectionEnd:function(){var e=this.getEngine();e&&(this.isCapacitor()?e.selectionEnd():e.gestureSelectionEnd())}},s=function(){n.selection()},i=function(){n.selectionStart()},a=function(){n.selectionChanged()},o=function(){n.selectionEnd()},u=function(e){n.impact(e)}},"6i10":function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var n={bubbles:{dur:1e3,circles:9,fn:function(e,t,r){var n=e*t/r-e+"ms",s=2*Math.PI*t/r;return{r:5,style:{top:9*Math.sin(s)+"px",left:9*Math.cos(s)+"px","animation-delay":n}}}},circles:{dur:1e3,circles:8,fn:function(e,t,r){var n=t/r,s=e*n-e+"ms",i=2*Math.PI*n;return{r:5,style:{top:9*Math.sin(i)+"px",left:9*Math.cos(i)+"px","animation-delay":s}}}},circular:{dur:1400,elmDuration:!0,circles:1,fn:function(){return{r:20,cx:48,cy:48,fill:"none",viewBox:"24 24 48 48",transform:"translate(0,0)",style:{}}}},crescent:{dur:750,circles:1,fn:function(){return{r:26,style:{}}}},dots:{dur:750,circles:3,fn:function(e,t){return{r:6,style:{left:9-9*t+"px","animation-delay":-110*t+"ms"}}}},lines:{dur:1e3,lines:12,fn:function(e,t,r){return{y1:17,y2:29,style:{transform:"rotate(".concat(30*t+(t<6?180:-180),"deg)"),"animation-delay":e*t/r-e+"ms"}}}},"lines-small":{dur:1e3,lines:12,fn:function(e,t,r){return{y1:12,y2:20,style:{transform:"rotate(".concat(30*t+(t<6?180:-180),"deg)"),"animation-delay":e*t/r-e+"ms"}}}}}},NcIQ:function(e,t,r){"use strict";r.d(t,"a",(function(){return c}));var n=r("mrSG"),i=r("gcOT"),o=r("fXoL"),u=function(e){return e.USER_CREDENTIALS="credentials",e.SESSION_ID="session_id",e.SESSION_EXPIRATION="session_expiration",e.ADMIN="admin",e}({}),c=function(){var e=function(){function e(){s(this,e)}return a(e,[{key:"fetch",value:function(e){return Object(n.a)(this,void 0,void 0,regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,i.b.get({key:"settings."+e});case 2:return r=t.sent,t.abrupt("return",JSON.parse(r.value));case 4:case"end":return t.stop()}}),t)})))}},{key:"fetchSecure",value:function(e){return Object(n.a)(this,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.fetch(e);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t,this)})))}},{key:"store",value:function(e,t){return Object(n.a)(this,void 0,void 0,regeneratorRuntime.mark((function r(){var n;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return n=JSON.stringify(t),r.next=3,i.b.set({key:"settings."+e,value:n});case 3:case"end":return r.stop()}}),r)})))}},{key:"storeSecure",value:function(e,t){return Object(n.a)(this,void 0,void 0,regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:JSON.stringify(t),this.store(e,t);case 1:case"end":return r.stop()}}),r,this)})))}},{key:"fetchSessionId",value:function(){return Object(n.a)(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.fetch(u.SESSION_ID);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})))}},{key:"storeSessionId",value:function(e){return Object(n.a)(this,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.store(u.SESSION_ID,e);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t,this)})))}},{key:"fetchSessionExpiration",value:function(){return Object(n.a)(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=parseInt,e.next=3,this.fetch(u.SESSION_EXPIRATION);case 3:return e.t1=e.sent,e.abrupt("return",(0,e.t0)(e.t1));case 5:case"end":return e.stop()}}),e,this)})))}},{key:"storeSessionExpiration",value:function(e){return Object(n.a)(this,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.store(u.SESSION_EXPIRATION,e.toString());case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t,this)})))}},{key:"fetchAdmin",value:function(){return Object(n.a)(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.fetch(u.ADMIN);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})))}},{key:"storeAdmin",value:function(e){return Object(n.a)(this,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.store(u.ADMIN,e);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t,this)})))}}]),e}();return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=o.Db({token:e,factory:e.\u0275fac,providedIn:"root"}),e}()},NqGI:function(e,t,r){"use strict";r.d(t,"a",(function(){return s})),r.d(t,"b",(function(){return i}));var s=function(){var e=n(regeneratorRuntime.mark((function e(t,r,n,s,i){var a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=2;break}return e.abrupt("return",t.attachViewToDom(r,n,i,s));case 2:if("string"==typeof n||n instanceof HTMLElement){e.next=4;break}throw new Error("framework delegate is missing");case 4:if(a="string"==typeof n?r.ownerDocument&&r.ownerDocument.createElement(n):n,s&&s.forEach((function(e){return a.classList.add(e)})),i&&Object.assign(a,i),r.appendChild(a),e.t0=a.componentOnReady,!e.t0){e.next=12;break}return e.next=12,a.componentOnReady();case 12:return e.abrupt("return",a);case 13:case"end":return e.stop()}}),e)})));return function(t,r,n,s,i){return e.apply(this,arguments)}}(),i=function(e,t){if(t){if(e)return e.removeViewFromDom(t.parentElement,t);t.remove()}return Promise.resolve()}},PLN7:function(e,t,r){"use strict";r.d(t,"a",(function(){return f}));var n=r("mrSG"),i=r("tk/3"),o=r("AytR"),u=r("fXoL"),c=r("NcIQ"),f=function(){var e=function(){function e(t,r){s(this,e),this.httpClient=t,this.settingsStoreService=r}return a(e,[{key:"post",value:function(e,t){return Object(n.a)(this,void 0,void 0,regeneratorRuntime.mark((function r(){var n,s,a,u,c;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:n=null,s=o.a.HTTP_RETRY_LIMIT,a=0;case 1:return s-=1,r.prev=2,r.next=5,this.settingsStoreService.fetchSessionId();case 5:if(r.t0=r.sent,r.t0){r.next=8;break}r.t0="";case 8:return u=r.t0,c=void 0,r.next=12,this.httpClient.post(o.a.API_URL_BASE+e,t,{headers:(new i.c).set("Authorization",u)}).toPromise();case 12:if(!(n=r.sent).expiration){r.next=21;break}if(!("number"!=typeof(c=n.expiration||-1)||Math.round(c)!==c||c<0)){r.next=16;break}throw new Error("Bad server response: illegal session expiration");case 16:return c+=Date.now(),r.next=19,this.settingsStoreService.storeSessionExpiration(c);case 19:r.next=24;break;case 21:return c=Date.now()+o.a.SESSION_EXPIRATION,r.next=24,this.settingsStoreService.storeSessionExpiration(c);case 24:return r.abrupt("return",n);case 27:if(r.prev=27,r.t1=r.catch(2),r.t2=0===r.t1.status||429===r.t1.status||503===r.t1.status,!r.t2){r.next=47;break}if(0!==r.t1.status){r.next=35;break}r.t1.statusText="It looks like the server is down",a=o.a.HTTP_SERVER_DOWN_SLEEP,r.next=46;break;case 35:if(429!==r.t1.status){r.next=45;break}return r.t1.statusText="The server is too busy at the moment",r.t3=parseInt,r.next=40,r.t1.headers.get("Retry-After");case 40:r.t4=r.sent,r.t5=(0,r.t3)(r.t4),a=r.t5+1,r.next=46;break;case 45:503===r.t1.status&&(r.t1.statusText="The server was just restarted, please retry",a=15);case 46:r.t2=s>0;case 47:if(!r.t2){r.next=52;break}return console.log("Server busy or down, try again in ".concat(a," seconds")),r.next=51,new Promise((function(e){return setTimeout(e,1e3*a)}));case 51:return r.abrupt("continue",53);case 52:throw r.t1;case 53:r.next=1;break;case 55:case"end":return r.stop()}}),r,this,[[2,27]])})))}},{key:"sessionLoginInit",value:function(e){return Object(n.a)(this,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.post("session_login_init",e);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t,this)})))}},{key:"sessionLoginFini",value:function(e){return Object(n.a)(this,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.post("session_login_fini",e);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t,this)})))}},{key:"sessionLogout",value:function(e){return Object(n.a)(this,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.post("session_logout",e);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t,this)})))}},{key:"memberGet",value:function(e){return Object(n.a)(this,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.post("member_get",e);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t,this)})))}},{key:"memberGetProject",value:function(e){return Object(n.a)(this,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.post("member_project_get",e);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t,this)})))}},{key:"memberGetGroup",value:function(e){return Object(n.a)(this,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.post("member_group_get",e);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t,this)})))}},{key:"memberGetUser",value:function(e){return Object(n.a)(this,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.post("member_user_get",e);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t,this)})))}},{key:"memberGetUnassignedUser",value:function(e){return Object(n.a)(this,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.post("member_user_unassigned_get",e);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t,this)})))}},{key:"memberAddUsers",value:function(e){return Object(n.a)(this,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.post("member_add_users",e);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t,this)})))}},{key:"removeUser",value:function(e){return Object(n.a)(this,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.post("member_remove_user",e);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t,this)})))}},{key:"getScript",value:function(e){return Object(n.a)(this,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.post("script_get",e);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t,this)})))}},{key:"getGroupScript",value:function(e){return Object(n.a)(this,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.post("script_group_get",e);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t,this)})))}},{key:"putScript",value:function(e){return Object(n.a)(this,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.post("script_put",e);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t,this)})))}}]),e}();return e.\u0275fac=function(t){return new(t||e)(u.Qb(i.a),u.Qb(c.a))},e.\u0275prov=u.Db({token:e,factory:e.\u0275fac,providedIn:"root"}),e}()},"U/uv":function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));var n=r("sxy2"),s=r("ItpF"),i=r("2c9M"),a=function(e,t){var r,a,o=function(e,n,s){if("undefined"!=typeof document){var i=document.elementFromPoint(e,n);i&&t(i)?i!==r&&(c(),u(i,s)):c()}},u=function(e,t){r=e,a||(a=r);var s=r;Object(n.g)((function(){return s.classList.add("ion-activated")})),t()},c=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(r){var t=r;Object(n.g)((function(){return t.classList.remove("ion-activated")})),e&&a!==r&&r.click(),r=void 0}};return Object(s.createGesture)({el:e,gestureName:"buttonActiveDrag",threshold:0,onStart:function(e){return o(e.currentX,e.currentY,i.a)},onMove:function(e){return o(e.currentX,e.currentY,i.b)},onEnd:function(){c(!0),Object(i.e)(),a=void 0}})}},fJnV:function(t,r,n){"use strict";n.d(r,"a",(function(){return c}));var i=n("mrSG"),o=n("fXoL"),u=n("PLN7"),c=function(){var t=function(){function t(e){s(this,t),this.apiService=e}return a(t,[{key:"getMembers",value:function(){return Object(i.a)(this,void 0,void 0,regeneratorRuntime.mark((function t(){var r,n,s,i,a,o,u,c,f,p,h,v,d,l,m,g,b;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=null,t.prev=1,t.next=4,this.apiService.memberGetProject({});case 4:r=t.sent,t.next=12;break;case 7:if(t.prev=7,t.t0=t.catch(1),403===t.t0.status){t.next=11;break}throw console.error(t.t0),new Error("Failed to get projects: "+t.t0.statusText);case 11:throw new Error(t.t0.statusText);case 12:n=[],s=e(r),t.prev=14,s.s();case 16:if((i=s.n()).done){t.next=65;break}return a=i.value,o=a.project_id,u=[],n.push({project_id:a.project_id,project_name:a.project_name,project_members:u}),c=null,t.prev=21,t.next=24,this.apiService.memberGetGroup({project_id:o});case 24:c=t.sent,t.next=32;break;case 27:if(t.prev=27,t.t1=t.catch(21),403===t.t1.status){t.next=31;break}throw console.error(t.t1),new Error("Failed to get groups for project ".concat(o,": ").concat(t.t1.statusText));case 31:throw new Error(t.t1.statusText);case 32:f=e(c),t.prev=33,f.s();case 35:if((p=f.n()).done){t.next=55;break}return h=p.value,v=h.group_id,d=[],u.push({group_id:h.group_id,group_name:h.group_name,group_members:d}),l=null,t.prev=40,t.next=43,this.apiService.memberGetUser({group_id:v});case 43:l=t.sent,t.next=51;break;case 46:if(t.prev=46,t.t2=t.catch(40),403===t.t2.status){t.next=50;break}throw console.error(t.t2),new Error("Failed to get users for group ".concat(v,": ").concat(t.t2.statusText));case 50:throw new Error(t.t2.statusText);case 51:m=e(l);try{for(m.s();!(g=m.n()).done;)b=g.value,d.push({user_id:b.user_id,user_email:b.user_email})}catch(x){m.e(x)}finally{m.f()}case 53:t.next=35;break;case 55:t.next=60;break;case 57:t.prev=57,t.t3=t.catch(33),f.e(t.t3);case 60:return t.prev=60,f.f(),t.finish(60);case 63:t.next=16;break;case 65:t.next=70;break;case 67:t.prev=67,t.t4=t.catch(14),s.e(t.t4);case 70:return t.prev=70,s.f(),t.finish(70);case 73:return t.abrupt("return",n);case 74:case"end":return t.stop()}}),t,this,[[1,7],[14,67,70,73],[21,27],[33,57,60,63],[40,46]])})))}},{key:"getUnassignedUsers",value:function(){return Object(i.a)(this,void 0,void 0,regeneratorRuntime.mark((function t(){var r,n,s,i,a;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=null,t.prev=1,t.next=4,this.apiService.memberGetUnassignedUser({});case 4:r=t.sent,t.next=12;break;case 7:if(t.prev=7,t.t0=t.catch(1),403===t.t0.status){t.next=11;break}throw console.error(t.t0),new Error("Failed to get unassigned users: "+t.t0.statusText);case 11:throw new Error(t.t0.statusText);case 12:n=[],s=e(r);try{for(s.s();!(i=s.n()).done;)a=i.value,n.push(a)}catch(o){s.e(o)}finally{s.f()}return t.abrupt("return",r);case 16:case"end":return t.stop()}}),t,this,[[1,7]])})))}},{key:"addUsers",value:function(e,t){return Object(i.a)(this,void 0,void 0,regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return null,r.prev=1,r.next=4,this.apiService.memberAddUsers({group_id:e,user_ids:t});case 4:r.sent,r.next=12;break;case 7:if(r.prev=7,r.t0=r.catch(1),403===r.t0.status){r.next=11;break}throw console.error(r.t0),new Error("Failed to add users to group: "+r.t0.statusText);case 11:throw new Error(r.t0.statusText);case 12:case"end":return r.stop()}}),r,this,[[1,7]])})))}},{key:"removeUser",value:function(e){return Object(i.a)(this,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return null,t.prev=1,t.next=4,this.apiService.removeUser({user_id:e});case 4:t.sent,t.next=12;break;case 7:if(t.prev=7,t.t0=t.catch(1),403===t.t0.status){t.next=11;break}throw console.error(t.t0),new Error("Failed to remove user from group: "+t.t0.statusText);case 11:throw new Error(t.t0.statusText);case 12:case"end":return t.stop()}}),t,this,[[1,7]])})))}}]),t}();return t.\u0275fac=function(e){return new(e||t)(o.Qb(u.a))},t.\u0275prov=o.Db({token:t,factory:t.\u0275fac,providedIn:"root"}),t}()},pRC4:function(e,t,r){"use strict";r.d(t,"a",(function(){return h}));var n=r("mrSG"),i=r("AytR"),o=r("fXoL"),u=r("PLN7"),c=r("NcIQ"),f=new TextEncoder,p=/^[0-9a-f]+$/,h=function(){var e=function(){function e(t,r){s(this,e),this.apiService=t,this.settingsStoreService=r}return a(e,[{key:"bytesToHex",value:function(e){return Array.from(e).map((function(e){return e.toString(16).padStart(2,"0")})).join("")}},{key:"hash",value:function(e){return Object(n.a)(this,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=this,t.t1=Uint8Array,t.next=4,window.crypto.subtle.digest(i.a.HASH_ALGORITHM,f.encode(e));case 4:return t.t2=t.sent,t.t3=new t.t1(t.t2),t.abrupt("return",t.t0.bytesToHex.call(t.t0,t.t3));case 7:case"end":return t.stop()}}),t,this)})))}},{key:"hmac",value:function(e,t){return Object(n.a)(this,void 0,void 0,regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.t0=Uint8Array,r.t1=window.crypto.subtle,r.next=4,window.crypto.subtle.importKey("raw",f.encode(e),{name:"HMAC",hash:i.a.HASH_ALGORITHM},!1,["sign"]);case 4:return r.t2=r.sent,r.t3=f.encode(t),r.next=8,r.t1.sign.call(r.t1,"HMAC",r.t2,r.t3);case 8:return r.t4=r.sent,r.abrupt("return",new r.t0(r.t4));case 10:case"end":return r.stop()}}),r)})))}},{key:"pbkdf2",value:function(e,t,r){return Object(n.a)(this,void 0,void 0,regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.t0=this,n.t1=Uint8Array,n.t2=window.crypto.subtle,n.t3={name:"PBKDF2",hash:i.a.PASSWORD_ALGORITHM,salt:f.encode(t),iterations:r},n.next=6,window.crypto.subtle.importKey("raw",f.encode(e),"PBKDF2",!1,["deriveBits","deriveKey"]);case 6:return n.t4=n.sent,n.t5=8*i.a.PASSWORD_LENGTH,n.next=10,n.t2.deriveBits.call(n.t2,n.t3,n.t4,n.t5);case 10:return n.t6=n.sent,n.t7=new n.t1(n.t6),n.abrupt("return",n.t0.bytesToHex.call(n.t0,n.t7));case 13:case"end":return n.stop()}}),n,this)})))}},{key:"isLoggedIn",value:function(){return Object(n.a)(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.settingsStoreService.fetchSessionId();case 2:return t=e.sent,e.next=5,this.settingsStoreService.fetchSessionExpiration();case 5:return r=e.sent,e.abrupt("return",!!t&&r>Date.now());case 7:case"end":return e.stop()}}),e,this)})))}},{key:"submitLogin",value:function(e,t){return Object(n.a)(this,void 0,void 0,regeneratorRuntime.mark((function r(){var n,s,a,o,u,c,f,h,v,d,l,m,g,b,x,w,y,k;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,this.hash(e+i.a.HASH_SALT);case 2:return n=r.sent,s=this.bytesToHex(window.crypto.getRandomValues(new Uint8Array(i.a.NONCE_LENGTH))),a=null,r.prev=5,r.next=8,this.apiService.sessionLoginInit({email_hash:n,client_nonce:s});case 8:a=r.sent,r.next=16;break;case 11:if(r.prev=11,r.t0=r.catch(5),403===r.t0.status){r.next=15;break}throw console.error(r.t0),new Error("Failed to send init message: "+r.t0.statusText);case 15:throw new Error(r.t0.statusText);case 16:if(o=a.server_nonce,u=a.client_salt,c=a.iterations,f=a.challenge_expiration,a.client_nonce===s){r.next=19;break}throw new Error("Bad server response to init message: client nonce mismatch");case 19:if("string"==typeof o&&o.length===2*i.a.NONCE_LENGTH&&p.test(o)){r.next=21;break}throw new Error("Bad server response to init message: illegal server nonce");case 21:if("string"==typeof u&&u.length===2*i.a.HASH_LENGTH&&p.test(u)){r.next=23;break}throw new Error("Bad server response to init message: illegal client salt");case 23:if(!("number"!=typeof c||Math.round(c)!==c||c<i.a.ITERATIONS_MIN)){r.next=25;break}throw new Error("Bad server response to init message: illegal iterations");case 25:if(!("number"!=typeof f||Math.round(f)!==f||f<0)){r.next=27;break}throw new Error("Bad server response to init message: illegal expiration");case 27:return h="".concat(n,",").concat(s,",").concat(o,",").concat(u),r.next=30,this.pbkdf2(t,u,c);case 30:return v=r.sent,r.next=33,this.hmac(v,"Client Key");case 33:return d=r.sent,r.next=36,this.hash(this.bytesToHex(d));case 36:return l=r.sent,r.next=39,this.hmac(l,h);case 39:for(m=r.sent,g=0;g<i.a.HASH_LENGTH;g++)m[g]^=d[g];return b=null,r.prev=42,r.next=45,this.apiService.sessionLoginFini({email_hash:n,client_nonce:s,server_nonce:o,iterations:c,challenge_expiration:f,client_proof:this.bytesToHex(m)});case 45:b=r.sent,r.next=53;break;case 48:if(r.prev=48,r.t1=r.catch(42),403===r.t1.status){r.next=52;break}throw console.error(r.t1),new Error("Failed to send fini message: "+r.t1.statusText);case 52:throw new Error(r.t1.statusText);case 53:if(x=b.server_proof,w=b.session_id,y=b.admin,"string"==typeof x&&x.length===2*i.a.NONCE_LENGTH&&p.test(x)){r.next=56;break}throw new Error("Bad server response to fini message: illegal server proof");case 56:if("string"==typeof w&&o.length===2*i.a.NONCE_LENGTH&&p.test(w)){r.next=58;break}throw new Error("Bad server response to init message: illegal sessionId");case 58:if("boolean"==typeof y){r.next=60;break}throw new Error("Bad server response to init message: illegal admin flag");case 60:return r.t2=this,r.next=63,this.hmac(v,"Server Key");case 63:return r.t3=r.sent,k=r.t2.bytesToHex.call(r.t2,r.t3),r.t4=x,r.t5=this,r.next=69,this.hmac(k,h);case 69:if(r.t6=r.sent,r.t7=r.t5.bytesToHex.call(r.t5,r.t6),r.t4===r.t7){r.next=73;break}throw new Error("Bad server response to fini message: invalid server proof");case 73:if(!0===y){r.next=75;break}throw new Error("Error: this account has no administrator privileges");case 75:return r.next=77,this.settingsStoreService.storeSessionId(w);case 77:return r.next=79,this.settingsStoreService.storeAdmin(y);case 79:return r.abrupt("return",w);case 80:case"end":return r.stop()}}),r,this,[[5,11],[42,48]])})))}},{key:"submitLogout",value:function(){return Object(n.a)(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return null,e.prev=1,e.next=4,this.apiService.sessionLogout({});case 4:e.sent,e.next=12;break;case 7:if(e.prev=7,e.t0=e.catch(1),403===e.t0.status){e.next=11;break}throw console.error(e.t0),new Error("Failed to send logout message: "+e.t0.statusText);case 11:throw new Error(e.t0.statusText);case 12:return e.prev=12,e.next=15,this.settingsStoreService.storeSessionId("");case 15:return e.next=17,this.settingsStoreService.storeSessionExpiration(Date.now()-1);case 17:return e.finish(12);case 18:case"end":return e.stop()}}),e,this,[[1,7,12,18]])})))}}]),e}();return e.\u0275fac=function(t){return new(t||e)(o.Qb(u.a),o.Qb(c.a))},e.\u0275prov=o.Db({token:e,factory:e.\u0275fac,providedIn:"root"}),e}()},sPtc:function(e,t,r){"use strict";r.d(t,"a",(function(){return i})),r.d(t,"b",(function(){return a})),r.d(t,"c",(function(){return s})),r.d(t,"d",(function(){return u}));var s=function(e,t){return null!==t.closest(e)},i=function(e,t){return"string"==typeof e&&e.length>0?Object.assign((s=!0,(n="ion-color-"+e)in(r={"ion-color":!0})?Object.defineProperty(r,n,{value:s,enumerable:!0,configurable:!0,writable:!0}):r[n]=s,r),t):t;var r,n,s},a=function(e){var t={};return function(e){return void 0!==e?(Array.isArray(e)?e:e.split(" ")).filter((function(e){return null!=e})).map((function(e){return e.trim()})).filter((function(e){return""!==e})):[]}(e).forEach((function(e){return t[e]=!0})),t},o=/^[a-z][a-z0-9+\-.]*:/,u=function(){var e=n(regeneratorRuntime.mark((function e(t,r,n,s){var i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==t||"#"===t[0]||o.test(t)){e.next=4;break}if(!(i=document.querySelector("ion-router"))){e.next=4;break}return e.abrupt("return",(null!=r&&r.preventDefault(),i.push(t,n,s)));case 4:return e.abrupt("return",!1);case 5:case"end":return e.stop()}}),e)})));return function(t,r,n,s){return e.apply(this,arguments)}}()}}])}();